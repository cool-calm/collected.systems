---
import { Code } from 'astro/components';
import { default as wabtLoader } from 'wabt';

(globalThis as any)["wabt"] ||= await wabtLoader();
const wabt = (globalThis as any)["wabt"];
// const wabt = {};

const body = `
(module $single_func
      (func (export "answer") (result i32)
       i32.const 42
      )
    )
`.trim();

const wasmModule = wabt.parseWat("example.wat", body);
wasmModule.applyNames();
// const bytes = wasmModule.toText({});
const bytes = wasmModule.toBinary({}).buffer;
// const bytes = '';

// wasmModule.destroy();
---

<Code code={body} lang="wasm" />

<pre>{JSON.stringify(Object.keys(wabt))}</pre>
<pre>{typeof bytes}</pre>
<pre>{bytes}</pre>
<pre>{Array.from(bytes)}</pre>
<pre>{wasmModule}</pre>
